<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<link rel="stylesheet" href="CSS/Site.css">
<script src="http://worldwindserver.net/webworldwind/worldwindlib.js"
	type="text/javascript"></script>
<script src="JS/jquery-1.11.3.min.js" type="text/javascript"></script>
<script src="JS/xmlparser.js" type="text/javascript"></script>
<script src="http://malsup.github.com/jquery.form.js"></script>
</head>
<body>

	<div class="container">
		<div id="heading" class="hidden-xs">
			<h1>Welcome to wGlobe</h1>
		</div>
		<div class="row margintop30">
			<div class="col-md-12">
				<div class="col-md-7">
					<form method="POST">
						<div class="row">
							<div class="col-md-10">
								<div class="col-md-12">
									<div class="col-md-3">Servers:</div>
									<select id="servers" name="servers" class="blacktext">
										<option>Please select server</option>
										<option
											value="http://nomads.ncdc.noaa.gov/thredds/catalog.xml">http://nomads.ncdc.noaa.gov/thredds/catalog.xml</option>
										<option value="others">Other</option>
									</select>
								</div>
							</div>
							<div class="col-md-1">
								<p id="or">OR</p>
							</div>
						</div>
						<div class="row">
							<div class="col-md-10">
								<div id="otherserver" class="col-md-12 margintop10">

									<div class="col-md-4">Please enter URL:</div>
									<div class="col-md-8">
										<input type="text" class=" blacktext" id="textUrl"
											name="textUrl"> <input name="submit" id="submit"
											type="submit" class="blacktext margintop10 pull-right"
											value="Submit">

									</div>
								</div>
							</div>

						</div>
					</form>
				</div>
				<div class="col-md-5">
					<div class="row">
						<form id="uploadform" name="uploadform" method="POST"
							action="Upload" enctype="multipart/form-data">
							<div class="col-md-2">File:</div>
							<div class="col-md-10">
								<input type="file" name="file" />
							</div>
							<div class="col-md-11">
								<input id="uploadbtn" name="uploadbtn" type="submit"
									class="blacktext pull-right" value="Upload"
									onclick="submitform()">
							</div>
						</form>
					</div>
				</div>

			</div>
		</div>
		<div class="row">
			<div class="col-md-4 margintop30">
				<div class="col-md-12">
					<div class="col-md-11">
						<div class="col-md-12">
							<div id="data" class="col-md-12 well" style="display: block">

							</div>
							<div class="ball"></div>
							<div class="ball1"></div>

						</div>
					</div>
				</div>
			</div>
			<div id="globe" class="row col-md-8 margintop30">

				<div class="col-md-12">
					<div class="col-md-8">
						<div>
							<canvas id="canvasOne" width="500" height="500">
			        				Your browser does not support HTML5 Canvas.
			   					</canvas>
						</div>
					</div>
				</div>
			</div>
		</div>


	</div>

	<script>
		// Register an event listener to be called when the page is loaded.
		window.addEventListener("load", eventWindowLoaded, false);

		// Define the event listener to initialize Web World Wind.
		function eventWindowLoaded() {
			// Create a World Window for the canvas.
			var wwd = new WorldWind.WorldWindow("canvasOne");

			// Add some image layers to the World Window's globe.
			wwd.addLayer(new WorldWind.BMNGOneImageLayer());
			wwd.addLayer(new WorldWind.BingAerialWithLabelsLayer());

			// Add a compass and some view controls to the World Window.
			wwd.addLayer(new WorldWind.CompassLayer());
			wwd.addLayer(new WorldWind.ViewControlsLayer(wwd));

			// Tell the World Window to redraw.
			wwd.redraw();
		}

		$("#servers").change(function() {
			//get the selected value
			var selectedValue = this.value;

			if (selectedValue == "others") {
				$("#otherserver").css("display", "block");
			} else {
				$("#otherserver").css("display", "none");
				$.ajax({
					url : 'Index',
					type : 'POST',
					data : {
						servers : selectedValue
					},
					success : function(data) {
						$("#data").css("display", "block");
						$('#data').html(data);
					}
				});
			}

			//make the ajax call

		});

		$("#submit").on('click', function() {
			var textUrl = $("#textUrl").val();
			var selectedValue = $("#servers").val();

			$("#data").html("");

			$(".ball").css("display", "block");
			$(".ball1").css("display", "block");
			$.ajax({
				url : 'Index',
				type : 'POST',
				data : {
					servers : selectedValue,
					textUrl : textUrl
				},
				success : function(data) {
					$("#data").css("display", "block");
					$('#data').html(data);
					$('#tree1').treed();
					$(".ball").css("display", "none");
					$(".ball1").css("display", "none");
				}
			});
			return false;
		});

		$.fn
				.extend({
					treed : function(o) {

						var openedClass = 'glyphicon-minus-sign';
						var closedClass = 'glyphicon-plus-sign';

						if (typeof o != 'undefined') {
							if (typeof o.openedClass != 'undefined') {
								openedClass = o.openedClass;
							}
							if (typeof o.closedClass != 'undefined') {
								closedClass = o.closedClass;
							}
						}
						;

						//initialize each of the top levels
						var tree = $(this);
						tree.addClass("tree");
						tree
								.find('li')
								.has("ul")
								.each(
										function() {
											var branch = $(this); //li with children ul
											branch
													.prepend("<i class='indicator glyphicon " + closedClass + "'></i>");
											branch.addClass('branch');
											branch
													.on(
															'click',
															function(e) {
																if (this == e.target) {
																	var icon = $(
																			this)
																			.children(
																					'i:first');
																	icon
																			.toggleClass(openedClass
																					+ " "
																					+ closedClass);
																	$(this)
																			.children()
																			.children()
																			.toggle();
																}
															})
											branch.children().children()
													.toggle();
										});
						//fire event from the dynamically added icon
						tree.find('.branch .indicator').each(function() {
							$(this).on('click', function() {
								$(this).closest('li').click();
							});
						});
						//fire event to open branch if the li contains an anchor instead of text
						tree.find('.branch>a').each(function() {
							$(this).on('click', function(e) {
								$(this).closest('li').click();
								e.preventDefault();
							});
						});
						//fire event to open branch if the li contains a button instead of text
						tree.find('.branch>button').each(function() {
							$(this).on('click', function(e) {
								$(this).closest('li').click();
								e.preventDefault();
							});
						});
					}
				});

		// post to servlet
		function getMeasure(e) {
			var t = $(e).text();
			alert(t);
		}

		function toggleLoad() {
			$("#data").html("");

			$(".ball").css("display", "block");
			$(".ball1").css("display", "block");
		}
		
		
		
		function getDoc(frame) {
		     var doc = null;
		 
		     // IE8 cascading access check
		     try {
		         if (frame.contentWindow) {
		             doc = frame.contentWindow.document;
		         }
		     } catch(err) {
		     }
		 
		     if (doc) { // successful getting content
		         return doc;
		     }
		 
		     try { // simply checking may throw in ie8 under ssl or mismatched protocol
		         doc = frame.contentDocument ? frame.contentDocument : frame.document;
		     } catch(err) {
		         // last attempt
		         doc = frame.document;
		     }
		     return doc;
		 }
		
		$("#uploadform").submit(function(e)
		{
			$("#data").html("");

			$(".ball").css("display", "block");
			$(".ball1").css("display", "block");
		    var formObj = $(this);
		    var formURL = formObj.attr("action");
		 
		    if(window.FormData !== undefined)  // for HTML5 browsers
		    {
		 
		        var formData = new FormData(this);
		        $.ajax({
		            url: formURL,
		            type: 'POST',
		            data:  formData,
		            mimeType:"multipart/form-data",
		            contentType: false,
		            cache: true,
		            processData:false,
		            success: function(data)
		            {
		            	$("#data").css("display", "block");
						$('#data').html(data);
						$('#tree1').treed();
						$(".ball").css("display", "none");
						$(".ball1").css("display", "none");
		            }          
		       });
		        e.preventDefault();
		        e.unbind();
		   }
		   else  //for olden browsers
		    {
		        //generate a random id
		        var  iframeId = 'unique' + (new Date().getTime());
		 
		        //create an empty iframe
		        var iframe = $('<iframe src="javascript:false;" name="'+iframeId+'" />');
		 
		        //hide it
		        iframe.hide();
		 
		        //set form target to iframe
		        formObj.attr('target',iframeId);
		 
		        //Add iframe to body
		        iframe.appendTo('body');
		        iframe.load(function(e)
		        {
		            var doc = getDoc(iframe[0]);
		            var docRoot = doc.body ? doc.body : doc.documentElement;
		            var data = docRoot.innerHTML;
		            //data is returned from server.
		 
		        });
		 
		    }     
		});
		/* $("#uploadform").submit(); */
	</script>
</body>
</html>