<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 
<link rel="stylesheet" href="CSS/CoordinateController.css">
<script src="http://worldwindserver.net/webworldwind/worldwindlib.js"
	type="text/javascript"></script>

<script src="JS/xmlparser.js" type="text/javascript"></script>

<script src="http://malsup.github.com/jquery.form.js"></script>
<script data-main="Index"
	src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.17/require.min.js"></script> -->
<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<link rel="stylesheet" href="./CoordinateController.css">
<link rel="stylesheet" href="CSS/jquery.loading.min.css">
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"
	type="text/javascript"></script>
<script
	src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script data-main="Index"
	src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.17/require.min.js"></script>
<link rel="stylesheet" href="CSS/Site.css">
</head>
<body>
	<div class="container">
		<div class="jumbotron hidden-xs">
			<h1 style="text-align: center">Welcome to wGlobe</h1>
		</div>
		<div class="row margintop30">
			<div class="col-md-12">
				<div class="col-md-7">
					<div class="row">
						<div class="col-md-10">
							<div class="col-md-12">

								<div class="col-md-3">Servers:</div>
								<select id="servers" name="servers" class="blacktext">
									<option>Please select server</option>
									<option value="http://nomads.ncdc.noaa.gov/thredds/catalog.xml">http://nomads.ncdc.noaa.gov/thredds/catalog.xml</option>
									<option value="others">Other</option>
								</select>
							</div>
						</div>
						<div class="col-md-1">
							<p id="or">OR</p>
						</div>
					</div>
					<div class="row">
						<div class="col-md-10">
							<div id="otherserver" class="col-md-12 margintop10">

								<div class="col-md-4">Please enter URL:</div>
								<div class="col-md-8">
									<input type="text" class=" blacktext" id="textUrl"
										name="textUrl"> <input name="submit" id="submit"
										type="submit" class="blacktext margintop10 pull-right"
										value="Submit">

								</div>
							</div>
						</div>

					</div>
				</div>
				<div class="col-md-5">
					<div class="row">
						<form id="uploadform" name="uploadform" method="POST"
							action="Upload" enctype="multipart/form-data">
							<div class="col-md-2">File:</div>
							<div class="col-md-10">
								<input type="file" name="file" />
							</div>
							<div class="col-md-11">
								<input id="uploadbtn" name="uploadbtn" type="submit"
									class="blacktext pull-right" value="Upload">
							</div>
						</form>
					</div>
				</div>

			</div>
		</div>

		<div class="row margintop50">
			<div class="col-sm-3 blacktext">
				<h4 class="whitetext">Projection</h4>
				<div class="dropdown" id="projectionDropdown"></div>
				<br>

				<div id="data" class="col-md-12 well" style="display: block">

				</div>
				<div class="ball"></div>
				<div class="ball1"></div>
			</div>
			<div class="col-sm-9" id="globe">
				<div style="position: relative">
					<canvas id="canvasOne" width="1000" height="1000"
						style="width: 100%; height: auto">
                    Your browser does not support HTML5 Canvas.
                </canvas>
					<div id="coordinateOverlay">
						<span id="terrainLatitude"></span> <span id="terrainLongitude"></span>
						<span id="terrainElevation"></span> <span id="eyeAltitudeLabel">Eye</span>
						<span id="eyeAltitude"></span>
					</div>
				</div>
			</div>
			<div class="col-sm-12 well margintop30" id="variablepanel"
				style="display: none">
				<div id="variableError" class="redtext text-center"></div>
				<div id="variabledialog" class="row margintop30"></div>

				<button id="popupsubmit" class="blacktext margintop10 pull-right"
					type="submit" name="popupsubmit">Submit</button>
			
			</div>

		</div>
	</div>

	<script src="JS/jquery-1.11.3.min.js" type="text/javascript"></script>
	<script src="JS/jquery.loading.min.js" type="text/javascript"></script>

	<script type="text/javascript">
	
		$("#servers").change(function() {
			//get the selected value
			var selectedValue = this.value;

			if (selectedValue == "others") {
				$("#otherserver").css("display", "block");
			} else if (this.selectedIndex != 0) {
				$("#myModal").modal('show')
				$("#otherserver").css("display", "none");

				$("#data").html("");

				$("#modalball").css("display", "block");
				$("#modalball1").css("display", "block");
				$.ajax({
					url : 'Index',
					type : 'POST',
					data : {
						servers : selectedValue
					},
					success : function(data) {
						$("#data").css("display", "block");
						$('#data').html(data);
					}
				});
			}

		});
		

		$("#submit").on('click', function() {
			var textUrl = $("#textUrl").val();
			var selectedValue = $("#servers").val();

			$('body').loading('start');
			$.ajax({
				url : 'Index',
				type : 'POST',
				data : {
					servers : selectedValue,
					textUrl : textUrl
				},
				success : function(data) {
					$("#data").css("display", "block");
					$('#data').html(data);
					$('#tree1').treed();
					$(".ball").css("display", "none");
					$(".ball1").css("display", "none");
					$('body').loading('stop');
				}
			});
			return false;
		});
		
		
		
		$(document.body).on('click', '.vars' ,function(){
			var variable = $(this).text();
			
			$('body').loading('start');
			$.ajax({
				url : 'Variable',
				type : 'POST',
				data : {
					variable : variable
				},
				success : function(data) {
					$("#variabledialog").css("display", "block");
					$("#variablepanel").css("display", "block");
					$('#variabledialog').html(data);
					$('body').loading('stop');
				}
			});
			return false;
		});
		
		

		$.fn
				.extend({
					treed : function(o) {

						var openedClass = 'glyphicon-minus-sign';
						var closedClass = 'glyphicon-plus-sign';

						if (typeof o != 'undefined') {
							if (typeof o.openedClass != 'undefined') {
								openedClass = o.openedClass;
							}
							if (typeof o.closedClass != 'undefined') {
								closedClass = o.closedClass;
							}
						}
						;

						//initialize each of the top levels
						var tree = $(this);
						tree.addClass("tree");
						tree
								.find('li')
								.has("ul")
								.each(
										function() {
											var branch = $(this); //li with children ul
											branch
													.prepend("<i class='indicator glyphicon " + closedClass + "'></i>");
											branch.addClass('branch');
											branch
													.on(
															'click',
															function(e) {
																if (this == e.target) {
																	var icon = $(
																			this)
																			.children(
																					'i:first');
																	icon
																			.toggleClass(openedClass
																					+ " "
																					+ closedClass);
																	$(this)
																			.children()
																			.children()
																			.toggle();
																}
															})
											branch.children().children()
													.toggle();
										});
						//fire event from the dynamically added icon
						tree.find('.branch .indicator').each(function() {
							$(this).on('click', function() {
								$(this).closest('li').click();
							});
						});
						//fire event to open branch if the li contains an anchor instead of text
						tree.find('.branch>a').each(function() {
							$(this).on('click', function(e) {
								$(this).closest('li').click();
								e.preventDefault();
							});
						});
						//fire event to open branch if the li contains a button instead of text
						tree.find('.branch>button').each(function() {
							$(this).on('click', function(e) {
								$(this).closest('li').click();
								e.preventDefault();
							});
						});
					}
				});

		// post to servlet
	
		function getDoc(frame) {
			var doc = null;

			// IE8 cascading access check
			try {
				if (frame.contentWindow) {
					doc = frame.contentWindow.document;
				}
			} catch (err) {
			}

			if (doc) { // successful getting content
				return doc;
			}

			try { // simply checking may throw in ie8 under ssl or mismatched protocol
				doc = frame.contentDocument ? frame.contentDocument
						: frame.document;
			} catch (err) {
				// last attempt
				doc = frame.document;
			}
			return doc;
		}

		$("#uploadform")
				.submit(
						function(e) {
							$("#data").html("");
							$('body').loading('start');
							$(".ball").css("display", "block");
							$(".ball1").css("display", "block");
							var formObj = $(this);
							var formURL = formObj.attr("action");

							if (window.FormData !== undefined) // for HTML5 browsers
							{

								var formData = new FormData(this);
								$.ajax({
									url : formURL,
									type : 'POST',
									data : formData,
									mimeType : "multipart/form-data",
									contentType : false,
									cache : true,
									processData : false,
									success : function(data) {
										$("#data").css("display", "block");
										$('#data').html(data);
										$('#tree1').treed();
										$(".ball").css("display", "none");
										$(".ball1").css("display", "none");
										$('body').loading('stop');
									}
								});
								e.preventDefault();
							} else //for olden browsers
							{
								//generate a random id
								var iframeId = 'unique'
										+ (new Date().getTime());

								//create an empty iframe
								var iframe = $('<iframe src="javascript:false;" name="'+iframeId+'" />');

								//hide it
								iframe.hide();

								//set form target to iframe
								formObj.attr('target', iframeId);

								//Add iframe to body
								iframe.appendTo('body');
								iframe.load(function(e) {
									var doc = getDoc(iframe[0]);
									var docRoot = doc.body ? doc.body
											: doc.documentElement;
									var data = docRoot.innerHTML;
									//data is returned from server.

								});

							}
						});
	</script>
</body>
</html>